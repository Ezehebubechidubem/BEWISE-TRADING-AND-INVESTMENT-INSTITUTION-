<!-- templates/course.html -->
<!doctype html>
<html>
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Courses — Crypto Training</title>
<link rel="icon" href="/logo.png">
<style>
  body{font-family:system-ui; margin:0; background:#071024; color:#e6eef8}
  header{display:flex; align-items:center; gap:12px; padding:12px; background:linear-gradient(90deg,#06203a,#08304d)}
  .logo{height:36px}
  .wrap{padding:18px; max-width:900px; margin:0 auto}
  .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:14px}
  .card{background:#062035; padding:12px; border-radius:12px; position:relative; overflow:hidden}
  video{width:100%; height:auto; border-radius:8px; background:black}
  .title{margin-top:8px; font-weight:700}
  /* Disable text selection & right-click */
  *{user-select:none; -webkit-user-select:none; -ms-user-select:none}
</style>
</head>
<body>
<header><img src="/logo.png" class="logo"><h3 style="margin:0">Courses</h3></header>
<div class="wrap">
  <p style="opacity:0.9">You can watch videos here. Downloading is disabled (best-effort). Screenshots and screen recording can't be fully prevented on the web — see note below.</p>
  <div id="grid" class="grid"></div>
  <div style="margin-top:12px; font-size:13px; opacity:0.8">
    <strong>Note:</strong> A web app cannot absolutely prevent OS-level screenshots / recording. For production-grade protection use DRM solutions or a native app.
  </div>
</div>

<script>
  // block right click
  document.addEventListener('contextmenu', e => e.preventDefault());

  async function loadVideos(){
    const res = await fetch('/api/videos');
    const videos = await res.json();
    const grid = document.getElementById('grid');
    grid.innerHTML = '';
    for(const v of videos){
      const card = document.createElement('div'); card.className = 'card';
      const vid = document.createElement('video');
      // no download option
      vid.setAttribute('controls', ''); 
      vid.setAttribute('controlsList', 'nodownload nofullscreen noremoteplayback');
      vid.setAttribute('playsinline','');
      vid.setAttribute('webkit-playsinline','');
      vid.oncontextmenu = e => e.preventDefault();

      // source uses stream endpoint (server checks session cookie)
      vid.src = '/stream/' + v.id;
      const t = document.createElement('div'); t.className='title'; t.innerText = v.title || 'Untitled';
      card.appendChild(vid);
      card.appendChild(t);
      grid.appendChild(card);
      // small measure: hide controls if not logged in
      vid.addEventListener('play', async ()=>{
        const chk = await (await fetch('/api/check_session')).json();
        if(!chk.logged_in){
          vid.pause();
          alert('Please login with your PIN first.');
          window.location.href = '/';
        }
      });
    }
  }

  // Blur video when page loses visibility (makes simple anti-snoop)
  document.addEventListener('visibilitychange', ()=>{
    const vids = document.querySelectorAll('video');
    if(document.visibilityState !== 'visible'){
      vids.forEach(v => { try{ v.style.filter='blur(6px)'; }catch(e){} });
    } else {
      vids.forEach(v => { try{ v.style.filter='none'; }catch(e){} });
    }
  });

  loadVideos();
</script>
</body>
</html>
